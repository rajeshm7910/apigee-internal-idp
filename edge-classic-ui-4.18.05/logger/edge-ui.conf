<source>
type tail
#Following line is added to push the log from the beginning. This is not a problem in case of AMI as pos and log files
# are generated at the same time. Please be careful if you are copy paste this config somewhere else.
read_from_head true
path /opt/apigee/var/log/edge-ui/application*.log
 pos_file /opt/apigee/var/log/edge-ui/edge-ui.pos
 tag edge-ui_logs
 format multiline
 format_firstline /^\d{4}-\d{1,2}-\d{1,2}/
 format1 /^(?<time>\d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}:\d{1,2},\d{1,3}) \[(?<level>[^\]]*)\] (?<message>.*)/
</source>

<filter edge-ui_logs>
  type record_transformer
  <record>
    host 10.128.0.9
    region dc-1
    pod gateway
    az ${APIGEE_AZ}
    release 4.18.05
    dpcolor green
  </record>
</filter>

<match edge-ui_logs>
    @type copy
    <store>
      @type google_cloud
        # Set the chunk limit conservatively to avoid exceeding the limit
        # of 10MB per write request.
          buffer_chunk_limit 2M
          flush_interval 5s
          # Never wait longer than 5 minutes between retries.
          max_retry_wait 300
         # Disable the limit on the number of retries (retry forever).
         disable_retry_limit
         # Use multiple threads for processing.
          num_threads 8
   </store>
</match>
